{% extends "base.html" %}
{% block title %}支出{% endblock %}
{% block content %}

{% set prev_label  = '前一天' if mode=='day' else ('前一月' if mode=='month' else '前一年') %}
{% set today_label = '今日'   if mode=='day' else ('今月'   if mode=='month' else '今年') %}
{% set next_label  = '後一天' if mode=='day' else ('後一月' if mode=='month' else '後一年') %}
{% set date_label  = '日期'   if mode=='day' else ('月份'   if mode=='month' else '年份') %}

<div class="card toolbar toolbar--range">
  <form id="range-form" method="get" action="/expenses" class="row">
    <label class="label">模式</label>
    <select name="mode" id="mode">
      <option value="day"   {% if mode=='day' %}selected{% endif %}>當日</option>
      <option value="month" {% if mode=='month' %}selected{% endif %}>當月</option>
      <option value="year"  {% if mode=='year' %}selected{% endif %}>當年</option>
    </select>

    <label class="label">{{ date_label }}</label>
    <input type="date" name="dt" id="dt" value="{{ dt }}">

    <a class="btn pill primary" href="/expenses?mode={{ mode }}&dt={{ nav.prev }}">← {{ prev_label }}</a>
    <a class="btn pill primary" href="/expenses?mode={{ mode }}&dt={{ nav.today }}">{{ today_label }}</a>
    <a class="btn pill primary" href="/expenses?mode={{ mode }}&dt={{ nav.next }}">{{ next_label }} →</a>

    <span class="muted" style="margin-left:8px">期間：{{ start }} ~ {{ end }}</span>
  </form>
</div>

<form class="card toolbar" method="get" action="/expenses" style="align-items:center">
  <input type="hidden" name="mode" value="{{ mode }}">
  <input type="hidden" name="dt" value="{{ dt }}">
  <label class="label">關鍵字</label>
  <input class="input" type="text" name="q" value="{{ q }}" placeholder="搜尋分類或備註（清空=全部）">
  <label class="label">起</label>
  <input class="input" type="date" name="start" value="{{ start }}">
  <label class="label">迄</label>
  <input class="input" type="date" name="end" value="{{ end }}">
  <button class="btn pill primary" type="submit">🔎 搜尋</button>
</form>

<form class="card toolbar" method="post" action="/expenses/create" id="form-create-exp">
  <div class="row"><label>日期</label><input class="input" type="date" name="odt" value="{{ dt }}"></div>
  <div class="row"><label>分類</label>
    <select class="input" name="cat" required>
      <option>原料</option><option>租金</option><option>人事</option>
      <option>菜錢</option><option>雜支</option><option>租金水電</option><option>其他</option>
    </select>
  </div>
  <div class="row"><label>金額</label><input class="input" type="number" name="amount" step="1" placeholder="如 1200" required></div>
  <div class="row" style="min-width:260px"><label>備註</label><input class="input" type="text" name="memo" placeholder="選填"></div>
  <button class="btn btn-primary" type="submit">新增</button>
</form>

<form method="post" action="/expenses/delete" id="form-delete-exp">
  <table class="table table--expenses" id="expenses-table">
    <colgroup>
      <col style="width:20%"><col style="width:20%"><col style="width:20%"><col style="width:20%"><col style="width:20%">
    </colgroup>
    <thead>
      <tr>
        <th class="center">分類</th>
        <th class="center">金額</th>
        <th class="center">日期</th>
        <th class="center">備註</th>
        <th class="center">選取</th>
      </tr>
    </thead>
    <tbody id="expenses-body">
      {% for it in items %}
      <tr data-id="{{ it.id }}">
        <td class="center editable" data-field="cat">{{ it.cat }}</td>
        <td class="center editable" data-field="amount">{{ it.amount|money }}</td>
        <td class="center editable" data-field="odt">{{ it.odt }}</td>
        <td class="center editable" data-field="memo">{{ it.memo }}</td>
        <td class="center"><input type="checkbox" name="selected" value="{{ it.id }}"></td>
      </tr>
      {% endfor %}
      {% if not items %}<tr><td colspan="5" class="center muted">目前沒有資料</td></tr>{% endif %}
    </tbody>
  </table>

  <div class="actionbar left">
    <button class="btn pill danger" type="submit">刪除選中</button>
  </div>
</form>

{% endblock %}
