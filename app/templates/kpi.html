{% extends "base.html" %}
{% block title %}ç‡Ÿæ¥­é¡{% endblock %}
{% block content %}

{% set prev_label = 'å‰ä¸€å¤©' if mode=='day' else ('å‰ä¸€æœˆ' if mode=='month' else 'å‰ä¸€å¹´') %}
{% set today_label = 'ä»Šæ—¥'  if mode=='day' else ('ä»Šæœˆ'  if mode=='month' else 'ä»Šå¹´') %}
{% set next_label = 'å¾Œä¸€å¤©' if mode=='day' else ('å¾Œä¸€æœˆ' if mode=='month' else 'å¾Œä¸€å¹´') %}

<div class="card toolbar toolbar--range kpi-head">
  <form id="range-form" method="get" action="/kpi" class="row">
    <label class="label">æ¨¡å¼</label>
    <select name="mode" id="mode">
      <option value="day"   {% if mode=='day' %}selected{% endif %}>ç•¶æ—¥</option>
      <option value="month" {% if mode=='month' %}selected{% endif %}>ç•¶æœˆ</option>
      <option value="year"  {% if mode=='year' %}selected{% endif %}>ç•¶å¹´</option>
    </select>
    <input type="date" name="dt" id="dt" value="{{ dt }}">
    <a class="btn pill primary" href="/kpi?mode={{ mode }}&dt={{ nav.prev }}">â† {{ prev_label }}</a>
    <a class="btn pill primary" href="/kpi?mode={{ mode }}&dt={{ nav.today }}">{{ today_label }}</a>
    <a class="btn pill primary" href="/kpi?mode={{ mode }}&dt={{ nav.next }}">{{ next_label }} â†’</a>
    <span class="kpi-note">æœŸé–“ï¼š{{ period }}</span>
  </form>
</div>

<div class="kpi-grid-4">
  <div class="kpi-mini kpi-early">ğŸ§¾ æ—©ç­{{ 'ç•¶æ—¥' if mode=='day' else ('ç•¶æœˆ' if mode=='month' else 'ç•¶å¹´') }}</div>
  <div class="kpi-mini kpi-late">ğŸŒ™ æ™šç­{{ 'ç•¶æ—¥' if mode=='day' else ('ç•¶æœˆ' if mode=='month' else 'ç•¶å¹´') }}</div>
  <div class="kpi-mini kpi-exp">ğŸ’³ ç•¶æ—¥æ”¯å‡º</div>
  <div class="kpi-mini kpi-total">ğŸ“Š ç•¶æ—¥ç¸½é¡</div>

  <div class="kpi-figure kpi-num-early">NT${{ k_early | money }}</div>
  <div class="kpi-figure kpi-num-late">NT${{ k_late  | money }}</div>
  <div class="kpi-figure kpi-num-exp">NT${{ k_exp   | money }}</div>
  <div class="kpi-figure kpi-num-total">NT${{ k_total | money }}</div>

  <div class="kpi-mini kpi-net">âœ… æ‰£æ”¯å‡ºå¾Œ</div>
  <div class="kpi-figure kpi-num-net">NT${{ k_net | money }}</div>
</div>

<script>
  const f=document.getElementById('range-form');
  document.getElementById('mode').addEventListener('change',()=>f.submit());
  document.getElementById('dt').addEventListener('change',()=>f.submit());
</script>
{% endblock %}
